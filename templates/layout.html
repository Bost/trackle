<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>trackle</title>
    <link type="text/css" rel="stylesheet" href="css/layout-default-latest.css" />
    <style type="text/css">

    p {
        font-size:        1em;
        margin:            1ex 0;
    }
    p.buttons {
        text-align:        center;
        line-height:    2.5em;
    }
    button {
        line-height:    normal;
    }
    .hidden {
        display:        none;
    }

    /*    Rules for simulated drop-down/pop-up lists */
    ul {
        /* rules common to BOTH inner and outer UL */
        z-index:    100000;
        margin:        1ex 0;
        padding:    0;
        list-style:    none;
        cursor:        pointer;
        border:        1px solid Black;
        /* rules for outer UL only */
        width:        15ex;
        position:    relative;
    }
    ul li {
        background-color: #EEE;
        padding: 0.15em 1em 0.3em 5px;
    }
    ul ul {
        display:    none;
        position:    absolute;
        width:        100%;
        left:        -1px;
        /* Pop-Up */
        bottom:        0;
        margin:        0;
        margin-bottom: 1.55em;
    }
    ul ul li        { padding: 3px 1em 3px 5px; }
    ul ul li:hover    { background-color: #FF9; }
    ul li:hover ul    { display:    block; background-color: #EEE; }

    </style>
<style type="text/css">
.ui-button .ui-button-text {
    line-height: 0.7em;
    font-weight: normal;
    font-size: small;
}
.uploadContainer {
/*
    float: left;
    border-style: solid;
*/
}
.detailLabels, .detailValues {
    height: 8em;
    float: left;
}
.detailLabels {
    width: 11.7em;
}
.detailValues {
    width: 21em;
}
.detailVal, .valFilename {
/*    padding-left is not needed if the checkbox is in front of the filename */
/*    padding-left: 0.5em;*/
    padding-right: 0.5em;
    padding-top: 0.2em;
    padding-bottom: 0.2em;
}
.valFilename {
    text-align: center;
    border-radius: 0.5em;
    color: white;
}
.detailVal {
    padding-left: 1.4em;
}
</style>

    <!-- LAYOUT v 1.3.0 -->
    <script type="text/javascript" src="js/jquery-latest.js"></script>
    <script type="text/javascript" src="js/jquery-ui-latest.js"></script>
    <script type="text/javascript" src="js/jquery.layout-latest.js"></script>

    <script type="text/javascript" src="js/debug.js"></script>
<script type="text/javascript" src="js/script.js"></script>
<link rel="stylesheet" href="css/ui-darkness/jquery-ui-1.8.23.custom.css">

    <script type="text/javascript">

    function toggleLiveResizing () {
        $.each( $.layout.config.borderPanes, function (i, pane) {
            var o = myLayout.options[ pane ];
            o.livePaneResizing = !o.livePaneResizing;
        });
    };

    function toggleStateManagement ( skipAlert, mode ) {
        if (!$.layout.plugins.stateManagement) return;

        var options    = myLayout.options.stateManagement
        ,    enabled    = options.enabled // current setting
        ;
        if ($.type( mode ) === "boolean") {
            if (enabled === mode) return; // already correct
            enabled    = options.enabled = mode
        }
        else
            enabled    = options.enabled = !enabled; // toggle option

        if (!enabled) { // if disabling state management...
            myLayout.deleteCookie(); // ...clear cookie so will NOT be found on next refresh
            if (!skipAlert)
                alert( 'This layout will reload as the options specify \nwhen the page is refreshed.' );
        }
        else if (!skipAlert)
            alert( 'This layout will save & restore its last state \nwhen the page is refreshed.' );

        // update text on button
        var $Btn = $('#btnToggleState'), text = $Btn.html();
        if (enabled)
            $Btn.html( text.replace(/Enable/i, "Disable") );
        else
            $Btn.html( text.replace(/Disable/i, "Enable") );
    };

    var myLayout;

    $(document).ready(function () {

        // this layout could be created with NO OPTIONS - but showing some here just as a sample...
        // myLayout = $('body').layout(); -- syntax with No Options

        myLayout = $('body').layout({

        //    reference only - these options are NOT required because 'true' is the default
            closable:                    true    // pane can open & close
        ,    resizable:                    true    // when open, pane can be resized
        ,    slidable:                    true    // when closed, pane can 'slide' open over other panes - closes on mouse-out
        ,    livePaneResizing:            true

        //    enable state management
        ,    stateManagement__enabled:    true // automatic cookie load & save enabled by default

        ,    showDebugMessages:            true // log and/or display messages from debugging & testing code

        });

        // if there is no state-cookie, then DISABLE state management initially
        var cookieExists = !$.isEmptyObject( myLayout.readCookie() );
        if (!cookieExists) toggleStateManagement( true, false );

        // 'Reset State' button requires updated functionality in rc29.15+
        if ($.layout.revision && $.layout.revision >= 0.032915)
            $('#btnReset').show();

        $(".cbox").button();
     });

function display(lon, lat, url, cboxClass, destId) {
    var arrUrlGpxTrack = new Array();
    var arrUrlDetailTrack = new Array();
    var arrTrackColors = new Array();

    $("."+cboxClass+":checked").each(function(){
        checkedElem = $(this);
        var urlGpxTrack = '/gpxtrack/'+checkedElem.attr('bkey');
        var urlDetail = '/details/'+checkedElem.attr('bkey');
        arrUrlGpxTrack.push(urlGpxTrack);
        arrUrlDetailTrack.push(urlDetail);
        arrTrackColors.push(checkedElem.attr('color'));
    });
    displayTracks(1, lon, lat, 16, arrUrlGpxTrack, arrUrlDetailTrack, arrTrackColors);
}
    </script>

</head>
<body>

<div class="ui-layout-center">
    <div style="width:100%; height:100%" id="map"></div>
</div>

<div class="ui-layout-south">
    <div class="uploadContainer">
        <form action="{{ url_upload_handler }}" method="POST" enctype="multipart/form-data">
            <div>Upload GPX file:</div>
            <input id="file" type="file" name="file" value="Val"/>

            <!--
            <label for="realupload">Upload file: </label>
            <div class="fakeupload">
                <input type="text" name="fakeupload" /> #!== browse button is here as background ==#
            </div>
            <input type="file" name="file" id="realupload" class="realupload" onchange="this.form.fakeupload.value = this.value;" />
            -->

            <button id="submit" type="submit" name="submit">Submit</button>
        </form>
        <div class="ui-widget" id="format">
            {% for e in entries %}
            <div>
                <input type="checkbox" color="{{ e.color }}" onclick="display({{ e.lon }}, {{ e.lat }}, '{{ e.cboxId }}', 'cbox', 'details')" class="cbox" bkey="{{ e.bKey }}" id="{{ e.cboxId }}" />
                <label for="{{ e.cboxId }}">{{ e.bFilename }}</label>
            </div>
            {% endfor %}
        </div>
    </div>
        <div id="details" style="height:100%">
            <div class="detailLabels">
                <div>filename:</div>
                <div>waypoints:</div>
                <div>averadge speed {{ speedUnits }}:</div>
                <div>duration {{ timeUnits }}:</div>
                <div>distance {{ distanceUnits }}:</div>
                <div>top speed {{ speedUnits }}:</div>
                <div>elevation gain {{ elevationUnits }}:</div>
            </div>
            <div id="detailContainer">
            </div>
        </div>
</div>

</body>
</html>

